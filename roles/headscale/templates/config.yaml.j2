# config.yaml Headscale — Géré par Ansible
server_url: "https://{{ domain_headscale }}"
listen_addr: 0.0.0.0:8080
metrics_listen_addr: 0.0.0.0:9090
private_key_path: /var/lib/headscale/private.key
noise:
  private_key_path: /var/lib/headscale/noise_private.key
prefixes:
  v4: 100.64.0.0/10
  v6: fd7a:115c:a1e0::/48
derp:
  server:
    enabled: true
    region_id: 999
    region_code: "seko"
    region_name: "Seko VPN Self-Hosted"
    stun_listen_addr: 0.0.0.0:3478
    private_key_path: /var/lib/headscale/derp_server_private.key
    automatically_add_embedded_derp_region: true
    ipv4: "{{ server_ip }}"
  urls: []
  paths: []
  auto_update_enabled: false
policy:
  path: /etc/headscale/policy.json
database:
  type: sqlite
  sqlite:
    path: /var/lib/headscale/db.sqlite
dns:
  magic_dns: true
  base_domain: "{{ headscale_base_domain }}"
  override_local_dns: true
  nameservers:
    global:
      - 1.1.1.1
      - 8.8.8.8
    split: {}
  search_domains: []
  # Extra records : résolution VPN-aware pour tous les clients Tailscale
  # Fonctionne sur WiFi public, 4G, téléphone — indépendant du DNS local
  extra_records:
    - name: "{{ domain_headscale }}"
      type: A
      value: "{{ server_tailscale_ip | default('100.64.0.14') }}"
    - name: "{{ domain_headplane }}"
      type: A
      value: "{{ server_tailscale_ip | default('100.64.0.14') }}"
    - name: "{{ domain_vaultwarden }}"
      type: A
      value: "{{ server_tailscale_ip | default('100.64.0.14') }}"
    - name: "{{ domain_portainer }}"
      type: A
      value: "{{ server_tailscale_ip | default('100.64.0.14') }}"
    - name: "{{ domain_zerobyte }}"
      type: A
      value: "{{ server_tailscale_ip | default('100.64.0.14') }}"
    - name: "{{ domain_uptime_kuma }}"
      type: A
      value: "{{ server_tailscale_ip | default('87.106.30.160') }}"
{% if nodes_extra_records is defined and nodes_extra_records | length > 0 %}
{% for node in nodes_extra_records %}
{% for domain in node.domains %}
    - name: "{{ domain }}"
      type: A
      value: "{{ node.tailscale_ip }}"
{% endfor %}
{% endfor %}
{% endif %}
log:
  level: info
