---
# Docker Compose - Caddy Reverse Proxy
# Géré par Ansible - NE PAS MODIFIER MANUELLEMENT

services:
  caddy:
    image: caddy:2-alpine
    container_name: caddy
    restart: unless-stopped
    ports:
      # Ports exposés publiquement
      - "80:80"       # HTTP (redirection automatique vers HTTPS)
      - "443:443"     # HTTPS
      - "443:443/udp" # HTTP/3 (QUIC)
    volumes:
      - {{ caddy_data_path }}/Caddyfile:/etc/caddy/Caddyfile:ro
      - {{ caddy_data_path }}/data:/data
      - {{ caddy_data_path }}/config:/config
    networks:
      - {{ docker_network_name }}
    # Limites de ressources
    deploy:
      resources:
        limits:
          memory: 256M
          cpus: '0.5'

networks:
  {{ docker_network_name }}:
    external: true
