---
# ============================================================
# VARIABLES PRINCIPALES - Projet VPN & Vault
# ============================================================
# Modifier ces valeurs AVANT le premier déploiement.
# Les secrets sont dans vault.yml (chiffré avec ansible-vault).

# --- Connexion SSH initiale ---
# IP ou FQDN du serveur cible
server_ip: "203.0.113.10"                    # Exemple: IP publique du serveur
# Port SSH (sera changé par le rôle security)
ssh_port: 22
# Utilisateur pour le déploiement initial (doit avoir un accès root ou sudo)
deploy_user: "root"
# Chemin vers la clé privée SSH locale
ssh_private_key_path: "~/.ssh/id_ed25519"

# --- Utilisateur système à créer ---
# Cet utilisateur remplacera root pour toute opération future
system_user: "srvadmin"                      # Exemple: "jean", "admin-vpn"
# Clé publique SSH de l'utilisateur (contenu de ~/.ssh/id_ed25519.pub)
system_user_ssh_pubkey: "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAI... user@machine"

# --- Noms de domaine (obligatoires pour les certificats SSL) ---
# Chaque service a son propre sous-domaine
domain_headscale: "hs.example.com"           # Exemple: "hs.mondomaine.fr"
domain_vaultwarden: "vault.example.com"      # Exemple: "vault.mondomaine.fr"
domain_portainer: "portainer.example.com"    # Exemple: "portainer.mondomaine.fr"

# Email pour les certificats Let's Encrypt (via Caddy)
acme_email: "admin@example.com"

# --- Sécurité SSH ---
# Nouveau port SSH (changé après la première connexion)
ssh_custom_port: 2222

# --- Docker ---
docker_compose_version: "2.29.1"

# --- Portainer ---
portainer_version: "2.21.4-alpine"
# Port interne de Portainer (exposé uniquement via Caddy)
portainer_internal_port: 9443

# --- Headscale ---
headscale_version: "0.23.0"
# Préfixes IP pour le réseau VPN Headscale
headscale_ip_prefixes:
  - "100.64.0.0/10"
  - "fd7a:115c:a1e0::/48"
# Port gRPC pour headscale CLI (interne uniquement)
headscale_grpc_port: 50443
# Activer/désactiver les Magic DNS
headscale_magic_dns: true
headscale_base_domain: "vpn.example.com"     # Domaine de base pour Magic DNS
# Configuration DERP personnalisée (pour se passer de Tailscale Inc)
# Mettre à true pour utiliser uniquement vos propres serveurs DERP
headscale_derp_auto_update: false
headscale_derp_update_frequency: "24h"

# --- Vaultwarden ---
vaultwarden_version: "1.32.5-alpine"
# Désactiver les inscriptions après la création du premier compte
vaultwarden_signups_allowed: true            # Passer à false après setup initial
# Nombre de workers Rocket
vaultwarden_rocket_workers: 4

# --- Réseau Docker ---
docker_network_name: "proxy-net"

# --- Firewall (UFW) ---
# Ports autorisés en entrée
ufw_allowed_ports:
  - { port: "{{ ssh_custom_port }}", proto: "tcp", comment: "SSH custom" }
  - { port: "80", proto: "tcp", comment: "HTTP (redirect vers HTTPS)" }
  - { port: "443", proto: "tcp", comment: "HTTPS (Caddy)" }
  - { port: "3478", proto: "udp", comment: "STUN/DERP Headscale" }

# --- Fail2Ban ---
fail2ban_maxretry: 3
fail2ban_bantime: 3600
fail2ban_findtime: 600

# --- Chemins sur le serveur ---
base_deploy_path: "/opt/services"
headscale_data_path: "{{ base_deploy_path }}/headscale"
vaultwarden_data_path: "{{ base_deploy_path }}/vaultwarden"
portainer_data_path: "{{ base_deploy_path }}/portainer"
caddy_data_path: "{{ base_deploy_path }}/caddy"
